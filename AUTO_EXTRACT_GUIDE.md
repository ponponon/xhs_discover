# 自动提取功能使用说明

## 功能概述

自动提取功能可以让你无需手动点击"提取帖子"按钮，就能自动捕获小红书探索页面的所有帖子信息。

## 核心特性

### 1. 智能检测
- ✅ 页面加载时自动提取
- ✅ 滚动时自动检测新帖子
- ✅ DOM变化实时监听
- ✅ 定时轮询检查

### 2. 灵活配置
- ✅ 可自定义检测间隔（1-10秒）
- ✅ 可设置最大提取数量
- ✅ 可选择是否显示通知
- ✅ 可单独开关各项功能

### 3. 状态反馈
- ✅ 实时状态显示（运行中/等待页面/未启用）
- ✅ 新帖子提取通知
- ✅ 设置保存确认

## 使用方法

### 启用自动提取

1. 打开小红书探索页面：https://www.xiaohongshu.com/explore
2. 点击浏览器扩展图标打开弹窗
3. 点击"自动提取"开关，开关变为红色表示已启用
4. 状态显示"运行中"，绿色圆点闪烁

### 配置自动提取

1. 点击"⚙️ 设置"按钮
2. 在设置面板中调整以下选项：

   **页面加载时自动提取**
   - 勾选：页面加载完成后自动提取所有帖子
   - 取消：页面加载时不自动提取

   **滚动时自动检测新帖子**
   - 勾选：滚动页面时自动检测并提取新加载的帖子
   - 取消：滚动时不自动检测

   **检测间隔（秒）**
   - 设置检测新帖子的时间间隔
   - 范围：1-10秒
   - 建议：2-3秒（平衡性能和响应速度）

   **最大提取数量**
   - 设置自动提取的最大帖子数量
   - 范围：10-500
   - 达到此数量后自动停止提取

   **提取时显示通知**
   - 勾选：提取新帖子时显示右上角通知
   - 取消：不显示通知（静默模式）

3. 点击"保存"按钮保存设置

### 禁用自动提取

1. 点击"自动提取"开关，开关变为灰色表示已禁用
2. 状态显示"未启用"
3. 自动提取功能停止运行

## 工作原理

### 检测机制

自动提取使用三种检测机制：

1. **DOM监听**：使用 MutationObserver 监听页面DOM变化
2. **滚动检测**：监听页面滚动事件，节流处理后检测新帖子
3. **定时轮询**：按照设定的间隔定期检查帖子数量

### 提取流程

```
用户启用自动提取
    ↓
检查当前页面是否为小红书探索页
    ↓
启动DOM监听器
    ↓
启动滚动检测器（如果启用）
    ↓
启动定时检查器（如果启用）
    ↓
检测到新帖子
    ↓
提取帖子数据
    ↓
发送通知到弹窗
    ↓
更新UI显示
```

### 性能优化

- **节流处理**：滚动事件节流500ms，避免频繁检测
- **智能过滤**：只监听特定容器（.feeds-page）
- **资源管理**：达到最大数量后自动停止
- **内存清理**：禁用时清理所有监听器和定时器

## 使用场景

### 场景1：快速收集

```
1. 启用自动提取
2. 快速滚动页面
3. 自动收集所有帖子
4. 一次性导出数据
```

### 场景2：持续监控

```
1. 启用自动提取
2. 设置较大检测间隔（如5秒）
3. 保持页面打开
4. 自动捕获新帖子
```

### 场景3：批量处理

```
1. 设置最大提取数量（如100）
2. 启用自动提取
3. 滚动页面直到达到上限
4. 导出数据进行批量处理
```

## 常见问题

### Q: 自动提取会影响页面性能吗？

A: 不会。自动提取使用了节流和优化机制，对页面性能影响很小。建议将检测间隔设置为2-3秒以获得最佳性能。

### Q: 为什么状态显示"等待页面"？

A: 这表示当前页面不是小红书探索页面。请确保你访问的是 https://www.xiaohongshu.com/explore

### Q: 自动提取会重复提取帖子吗？

A: 不会。自动提取会记录已提取的帖子数量，只提取新增的帖子。

### Q: 如何查看自动提取的日志？

A: 打开浏览器控制台（F12），可以看到自动提取的运行日志，包括：
- 自动提取启动/停止
- 检测到新帖子的数量
- 达到最大提取数量的提示

### Q: 自动提取的数据保存在哪里？

A: 自动提取的数据保存在浏览器的本地存储中，关闭浏览器后仍然保留。你可以随时打开弹窗查看和导出数据。

### Q: 可以在多个标签页同时使用自动提取吗？

A: 可以。每个标签页的自动提取是独立的，互不影响。

## 技术实现

### 核心类

**XiaohongshuScraper**
- 负责提取帖子数据
- 管理自动提取管理器
- 提供状态查询接口

**AutoExtractManager**
- 管理自动提取的生命周期
- 协调三种检测机制
- 处理新帖子的提取和通知

### 消息通信

```
Popup → Content Script
- START_AUTO_EXTRACT: 启动自动提取
- STOP_AUTO_EXTRACT: 停止自动提取
- GET_AUTO_EXTRACT_STATUS: 获取运行状态

Content Script → Popup
- AUTO_EXTRACT_NEW_POSTS: 通知有新帖子
```

### 存储结构

```javascript
{
  autoExtractSettings: {
    enabled: false,           // 是否启用
    extractOnLoad: true,       // 页面加载时提取
    detectOnScroll: true,      // 滚动时检测
    detectInterval: 2,         // 检测间隔（秒）
    maxPosts: 100,            // 最大提取数量
    showNotification: true     // 显示通知
  }
}
```

## 更新日志

### v1.0.0 (2025-12-29)
- ✅ 初始版本
- ✅ 实现自动提取功能
- ✅ 添加设置面板
- ✅ 实现状态反馈
- ✅ 添加通知系统

## 反馈与建议

如果你有任何问题或建议，欢迎反馈！
